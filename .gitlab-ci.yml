image: matrixise/hugo-for-wirtel.be

before_script:
  - eval $(ssh-agent -s)
#   - echo "$SSH_PRIVATE_KEY" | ssh-add -
  - echo "$SSH_PRIVATE_KEY" | tr -d '\r' | ssh-add - > /dev/null
  - mkdir -p ~/.ssh
  - echo "${SSH_HOST_KEY}" > "${HOME}/.ssh/known_hosts"
  - echo -e "Host *\n\tStrictHostKeyChecking no\n\n" > ~/.ssh/config
  - git submodule sync --recursive
  - git submodule update --init --recursive

pages:
  script:
    - hugo -t=ghostwriter -d public/
    - rsync -hrvz --chown=www-data:www-data --delete --exclude=_ -e 'ssh -i id_rsa' public/ root@vhost.wirtel.be:/home/www/www.wirtel.be/src/
  only:
    - master
